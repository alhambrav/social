<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/security
       http://www.springframework.org/schema/security/spring-security.xsd">
    <security:global-method-security pre-post-annotations="enabled" jsr250-annotations="disabled"
                                     secured-annotations="disabled">
        <security:expression-handler ref="socialMethodSecurityExpressionHandler"/>
    </security:global-method-security>

    <security:http realm="Protected API"
                   use-expressions="true"
                   auto-config="false"
                   create-session="stateless"
                   entry-point-ref="Http403ForbiddenEntryPoint"

            >
        <security:custom-filter ref="socialAuthenticationTokenProcessingFilter" position="FORM_LOGIN_FILTER"/>
        <security:intercept-url pattern="/**" access="isAuthenticated()"/>
    </security:http>

    <bean id="Http403ForbiddenEntryPoint"
          class="org.springframework.security.web.authentication.Http403ForbiddenEntryPoint"/>

    <bean id="socialAuthenticationTokenProcessingFilter"
          class="org.craftercms.social.ext.security.AuthenticationTokenProcessingFilter"/>
    <bean class="org.craftercms.social.ext.security.SocialMethodSecurityExpressionHandler"
          id="socialMethodSecurityExpressionHandler">
        <property name="permissionService" ref="permissionService"/>
    </bean>

</beans>
